<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/web_deploy.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/web_deploy.php" />
              <option name="originalContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;fr&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;title&gt;Déploiement Pedantix&lt;/title&gt;&#10;    &lt;style&gt;&#10;        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }&#10;        .step { margin: 20px 0; padding: 15px; border-left: 4px solid #007cba; background: #f8f9fa; }&#10;        .success { border-color: #28a745; background: #d4edda; }&#10;        .error { border-color: #dc3545; background: #f8d7da; }&#10;        .warning { border-color: #ffc107; background: #fff3cd; }&#10;        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }&#10;        button:hover { background: #0056b3; }&#10;        .output { background: #000; color: #0f0; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }&#10;        .form-group { margin: 10px 0; }&#10;        label { display: block; margin-bottom: 5px; font-weight: bold; }&#10;        input[type=&quot;text&quot;], input[type=&quot;password&quot;] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;h1&gt; Déploiement Pedantix&lt;/h1&gt;&#10;&#10;    &lt;div class=&quot;step warning&quot;&gt;&#10;        &lt;h3&gt;⚠️ Configuration requise&lt;/h3&gt;&#10;        &lt;p&gt;Avant de commencer, assurez-vous d'avoir :&lt;/p&gt;&#10;        &lt;ul&gt;&#10;            &lt;li&gt;Uploadé tous les fichiers du projet dans ce dossier&lt;/li&gt;&#10;            &lt;li&gt;Configuré votre domaine pour pointer vers le dossier &lt;code&gt;public/&lt;/code&gt;&lt;/li&gt;&#10;            &lt;li&gt;Vos informations de base de données OVH&lt;/li&gt;&#10;        &lt;/ul&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;step&quot;&gt;&#10;        &lt;h3&gt;1. Configuration de la base de données&lt;/h3&gt;&#10;        &lt;form id=&quot;configForm&quot;&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;db_host&quot;&gt;Host de base de données :&lt;/label&gt;&#10;                &lt;input type=&quot;text&quot; id=&quot;db_host&quot; value=&quot;localhost&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;db_name&quot;&gt;Nom de la base de données :&lt;/label&gt;&#10;                &lt;input type=&quot;text&quot; id=&quot;db_name&quot; placeholder=&quot;pedantix_prod&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;db_user&quot;&gt;Utilisateur base de données :&lt;/label&gt;&#10;                &lt;input type=&quot;text&quot; id=&quot;db_user&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;db_pass&quot;&gt;Mot de passe base de données :&lt;/label&gt;&#10;                &lt;input type=&quot;password&quot; id=&quot;db_pass&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;domain&quot;&gt;Votre nom de domaine :&lt;/label&gt;&#10;                &lt;input type=&quot;text&quot; id=&quot;domain&quot; placeholder=&quot;votre-domaine.com&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;button type=&quot;submit&quot;&gt; Sauvegarder la configuration&lt;/button&gt;&#10;        &lt;/form&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;step&quot; id=&quot;deploySection&quot; style=&quot;display: none;&quot;&gt;&#10;        &lt;h3&gt;2. Déploiement automatique&lt;/h3&gt;&#10;        &lt;button onclick=&quot;startDeployment()&quot;&gt; Démarrer le déploiement&lt;/button&gt;&#10;        &lt;div id=&quot;deployOutput&quot; class=&quot;output&quot; style=&quot;display: none;&quot;&gt;&lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;step success&quot; id=&quot;successSection&quot; style=&quot;display: none;&quot;&gt;&#10;        &lt;h3&gt;✅ Déploiement terminé !&lt;/h3&gt;&#10;        &lt;p&gt;Votre Pedantix est maintenant opérationnel avec :&lt;/p&gt;&#10;        &lt;ul&gt;&#10;            &lt;li&gt;Plus de 150 articles Wikipedia&lt;/li&gt;&#10;            &lt;li&gt;Modes Compétition et Coopération&lt;/li&gt;&#10;            &lt;li&gt;Nouvelles parties automatiques&lt;/li&gt;&#10;            &lt;li&gt;Ajout automatique d'articles depuis les URL&lt;/li&gt;&#10;        &lt;/ul&gt;&#10;        &lt;p&gt;&lt;strong&gt;N'oubliez pas de supprimer ce fichier après le déploiement !&lt;/strong&gt;&lt;/p&gt;&#10;        &lt;button onclick=&quot;window.location.href='/'&quot;&gt; Aller à Pedantix&lt;/button&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;script&gt;&#10;        document.getElementById('configForm').addEventListener('submit', function(e) {&#10;            e.preventDefault();&#10;&#10;            const formData = new FormData(e.target);&#10;            const config = {&#10;                db_host: document.getElementById('db_host').value,&#10;                db_name: document.getElementById('db_name').value,&#10;                db_user: document.getElementById('db_user').value,&#10;                db_pass: document.getElementById('db_pass').value,&#10;                domain: document.getElementById('domain').value&#10;            };&#10;&#10;            // Créer le fichier .env&#10;            fetch('?action=save_config', {&#10;                method: 'POST',&#10;                headers: {'Content-Type': 'application/json'},&#10;                body: JSON.stringify(config)&#10;            })&#10;            .then(response =&gt; response.json())&#10;            .then(data =&gt; {&#10;                if (data.success) {&#10;                    document.getElementById('deploySection').style.display = 'block';&#10;                    alert('Configuration sauvegardée !');&#10;                } else {&#10;                    alert('Erreur : ' + data.error);&#10;                }&#10;            });&#10;        });&#10;&#10;        function startDeployment() {&#10;            const output = document.getElementById('deployOutput');&#10;            output.style.display = 'block';&#10;            output.textContent = ' Démarrage du déploiement...\n';&#10;&#10;            fetch('?action=deploy')&#10;                .then(response =&gt; response.text())&#10;                .then(data =&gt; {&#10;                    output.textContent += data;&#10;                    if (data.includes('DÉPLOIEMENT RÉUSSI')) {&#10;                        document.getElementById('successSection').style.display = 'block';&#10;                    }&#10;                })&#10;                .catch(error =&gt; {&#10;                    output.textContent += '\n❌ Erreur : ' + error;&#10;                });&#10;        }&#10;    &lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;&#10;&#10;&lt;?php&#10;if ($_GET['action'] ?? '' === 'save_config') {&#10;    $input = json_decode(file_get_contents('php://input'), true);&#10;&#10;    $envContent = &quot;APP_ENV=prod\n&quot;;&#10;    $envContent .= &quot;APP_SECRET=&quot; . bin2hex(random_bytes(16)) . &quot;\n&quot;;&#10;    $envContent .= &quot;APP_DEBUG=0\n\n&quot;;&#10;    $envContent .= &quot;DATABASE_URL=\&quot;mysql://{$input['db_user']}:{$input['db_pass']}@{$input['db_host']}:3306/{$input['db_name']}?serverVersion=8.0&amp;charset=utf8mb4\&quot;\n\n&quot;;&#10;    $envContent .= &quot;TRUSTED_PROXIES=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16\n&quot;;&#10;    $envContent .= &quot;TRUSTED_HOSTS='^(localhost|127\.0\.0\.1|&quot; . preg_quote($input['domain'], '/') . &quot;)$'\n&quot;;&#10;&#10;    if (file_put_contents('.env', $envContent)) {&#10;        echo json_encode(['success' =&gt; true]);&#10;    } else {&#10;        echo json_encode(['success' =&gt; false, 'error' =&gt; 'Impossible d\'écrire le fichier .env']);&#10;    }&#10;    exit;&#10;}&#10;&#10;if ($_GET['action'] ?? '' === 'deploy') {&#10;    header('Content-Type: text/plain');&#10;&#10;    echo &quot;=== Installation de Composer ===\n&quot;;&#10;    if (!file_exists('composer.phar')) {&#10;        echo &quot;Téléchargement de Composer...\n&quot;;&#10;        file_put_contents('composer.phar', file_get_contents('https://getcomposer.org/composer.phar'));&#10;        chmod('composer.phar', 0755);&#10;    }&#10;    echo &quot;✅ Composer prêt\n\n&quot;;&#10;&#10;    echo &quot;=== Installation des dépendances ===\n&quot;;&#10;    $output = shell_exec('php composer.phar install --no-dev --optimize-autoloader --no-interaction 2&gt;&amp;1');&#10;    echo $output . &quot;\n&quot;;&#10;&#10;    echo &quot;=== Déploiement complet ===\n&quot;;&#10;    $output = shell_exec('php bin/console app:deploy prod 2&gt;&amp;1');&#10;    echo $output . &quot;\n&quot;;&#10;&#10;    echo &quot;=== Configuration des permissions ===\n&quot;;&#10;    if (is_dir('var/cache')) {&#10;        chmod('var/cache', 0775);&#10;        echo &quot;✅ Permissions var/cache configurées\n&quot;;&#10;    }&#10;    if (is_dir('var/log')) {&#10;        chmod('var/log', 0775);&#10;        echo &quot;✅ Permissions var/log configurées\n&quot;;&#10;    }&#10;&#10;    echo &quot;\n DÉPLOIEMENT RÉUSSI !\n&quot;;&#10;    echo &quot;Votre Pedantix est maintenant opérationnel !\n&quot;;&#10;    exit;&#10;}&#10;?&gt;&#10;" />
              <option name="updatedContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;fr&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;title&gt;Déploiement Pedantix&lt;/title&gt;&#10;    &lt;style&gt;&#10;        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }&#10;        .step { margin: 20px 0; padding: 15px; border-left: 4px solid #007cba; background: #f8f9fa; }&#10;        .success { border-color: #28a745; background: #d4edda; }&#10;        .error { border-color: #dc3545; background: #f8d7da; }&#10;        .warning { border-color: #ffc107; background: #fff3cd; }&#10;        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }&#10;        button:hover { background: #0056b3; }&#10;        .output { background: #000; color: #0f0; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }&#10;        .form-group { margin: 10px 0; }&#10;        label { display: block; margin-bottom: 5px; font-weight: bold; }&#10;        input[type=&quot;text&quot;], input[type=&quot;password&quot;] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;h1&gt; Déploiement Pedantix&lt;/h1&gt;&#10;&#10;    &lt;div class=&quot;step warning&quot;&gt;&#10;        &lt;h3&gt;⚠️ Configuration requise&lt;/h3&gt;&#10;        &lt;p&gt;Avant de commencer, assurez-vous d'avoir :&lt;/p&gt;&#10;        &lt;ul&gt;&#10;            &lt;li&gt;Uploadé tous les fichiers du projet dans ce dossier&lt;/li&gt;&#10;            &lt;li&gt;Configuré votre domaine pour pointer vers le dossier &lt;code&gt;public/&lt;/code&gt;&lt;/li&gt;&#10;            &lt;li&gt;Vos informations de base de données OVH&lt;/li&gt;&#10;        &lt;/ul&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;step&quot;&gt;&#10;        &lt;h3&gt;1. Configuration de la base de données&lt;/h3&gt;&#10;        &lt;form id=&quot;configForm&quot;&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;db_host&quot;&gt;Host de base de données :&lt;/label&gt;&#10;                &lt;input type=&quot;text&quot; id=&quot;db_host&quot; value=&quot;localhost&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;db_name&quot;&gt;Nom de la base de données :&lt;/label&gt;&#10;                &lt;input type=&quot;text&quot; id=&quot;db_name&quot; placeholder=&quot;pedantix_prod&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;db_user&quot;&gt;Utilisateur base de données :&lt;/label&gt;&#10;                &lt;input type=&quot;text&quot; id=&quot;db_user&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;db_pass&quot;&gt;Mot de passe base de données :&lt;/label&gt;&#10;                &lt;input type=&quot;password&quot; id=&quot;db_pass&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;form-group&quot;&gt;&#10;                &lt;label for=&quot;domain&quot;&gt;Votre nom de domaine :&lt;/label&gt;&#10;                &lt;input type=&quot;text&quot; id=&quot;domain&quot; placeholder=&quot;votre-domaine.com&quot; required&gt;&#10;            &lt;/div&gt;&#10;            &lt;button type=&quot;submit&quot;&gt; Sauvegarder la configuration&lt;/button&gt;&#10;        &lt;/form&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;step&quot; id=&quot;deploySection&quot; style=&quot;display: none;&quot;&gt;&#10;        &lt;h3&gt;2. Déploiement automatique&lt;/h3&gt;&#10;        &lt;button onclick=&quot;startDeployment()&quot;&gt; Démarrer le déploiement&lt;/button&gt;&#10;        &lt;div id=&quot;deployOutput&quot; class=&quot;output&quot; style=&quot;display: none;&quot;&gt;&lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;step success&quot; id=&quot;successSection&quot; style=&quot;display: none;&quot;&gt;&#10;        &lt;h3&gt;✅ Déploiement terminé !&lt;/h3&gt;&#10;        &lt;p&gt;Votre Pedantix est maintenant opérationnel avec :&lt;/p&gt;&#10;        &lt;ul&gt;&#10;            &lt;li&gt;Plus de 150 articles Wikipedia&lt;/li&gt;&#10;            &lt;li&gt;Modes Compétition et Coopération&lt;/li&gt;&#10;            &lt;li&gt;Nouvelles parties automatiques&lt;/li&gt;&#10;            &lt;li&gt;Ajout automatique d'articles depuis les URL&lt;/li&gt;&#10;        &lt;/ul&gt;&#10;        &lt;p&gt;&lt;strong&gt;N'oubliez pas de supprimer ce fichier après le déploiement !&lt;/strong&gt;&lt;/p&gt;&#10;        &lt;button onclick=&quot;window.location.href='/'&quot;&gt; Aller à Pedantix&lt;/button&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;script&gt;&#10;        document.getElementById('configForm').addEventListener('submit', function(e) {&#10;            e.preventDefault();&#10;            &#10;            console.log('Formulaire soumis'); // Debug&#10;            &#10;            const config = {&#10;                db_host: document.getElementById('db_host').value,&#10;                db_name: document.getElementById('db_name').value,&#10;                db_user: document.getElementById('db_user').value,&#10;                db_pass: document.getElementById('db_pass').value,&#10;                domain: document.getElementById('domain').value&#10;            };&#10;            &#10;            console.log('Configuration:', config); // Debug&#10;            &#10;            // Désactiver le bouton pendant la sauvegarde&#10;            const submitBtn = e.target.querySelector('button[type=&quot;submit&quot;]');&#10;            const originalText = submitBtn.innerHTML;&#10;            submitBtn.disabled = true;&#10;            submitBtn.innerHTML = ' Sauvegarde en cours...';&#10;&#10;            // Créer le fichier .env&#10;            fetch('?action=save_config', {&#10;                method: 'POST',&#10;                headers: {'Content-Type': 'application/json'},&#10;                body: JSON.stringify(config)&#10;            })&#10;            .then(response =&gt; {&#10;                console.log('Réponse reçue:', response); // Debug&#10;                if (!response.ok) {&#10;                    throw new Error('Erreur HTTP: ' + response.status);&#10;                }&#10;                return response.json();&#10;            })&#10;            .then(data =&gt; {&#10;                console.log('Données reçues:', data); // Debug&#10;                if (data.success) {&#10;                    document.getElementById('deploySection').style.display = 'block';&#10;                    alert('Configuration sauvegardée avec succès !');&#10;                } else {&#10;                    alert('Erreur lors de la sauvegarde : ' + (data.error || 'Erreur inconnue'));&#10;                }&#10;            })&#10;            .catch(error =&gt; {&#10;                console.error('Erreur complète:', error);&#10;                alert('Erreur de connexion : ' + error.message);&#10;            })&#10;            .finally(() =&gt; {&#10;                // Réactiver le bouton&#10;                submitBtn.disabled = false;&#10;                submitBtn.innerHTML = originalText;&#10;            });&#10;        });&#10;&#10;        function startDeployment() {&#10;            const output = document.getElementById('deployOutput');&#10;            output.style.display = 'block';&#10;            output.textContent = ' Démarrage du déploiement...\n';&#10;&#10;            fetch('?action=deploy')&#10;                .then(response =&gt; response.text())&#10;                .then(data =&gt; {&#10;                    output.textContent += data;&#10;                    if (data.includes('DÉPLOIEMENT RÉUSSI')) {&#10;                        document.getElementById('successSection').style.display = 'block';&#10;                    }&#10;                })&#10;                .catch(error =&gt; {&#10;                    output.textContent += '\n❌ Erreur : ' + error;&#10;                });&#10;        }&#10;    &lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;&#10;&#10;&lt;?php&#10;if ($_GET['action'] ?? '' === 'save_config') {&#10;    $input = json_decode(file_get_contents('php://input'), true);&#10;&#10;    $envContent = &quot;APP_ENV=prod\n&quot;;&#10;    $envContent .= &quot;APP_SECRET=&quot; . bin2hex(random_bytes(16)) . &quot;\n&quot;;&#10;    $envContent .= &quot;APP_DEBUG=0\n\n&quot;;&#10;    $envContent .= &quot;DATABASE_URL=\&quot;mysql://{$input['db_user']}:{$input['db_pass']}@{$input['db_host']}:3306/{$input['db_name']}?serverVersion=8.0&amp;charset=utf8mb4\&quot;\n\n&quot;;&#10;    $envContent .= &quot;TRUSTED_PROXIES=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16\n&quot;;&#10;    $envContent .= &quot;TRUSTED_HOSTS='^(localhost|127\.0\.0\.1|&quot; . preg_quote($input['domain'], '/') . &quot;)$'\n&quot;;&#10;&#10;    if (file_put_contents('.env', $envContent)) {&#10;        echo json_encode(['success' =&gt; true]);&#10;    } else {&#10;        echo json_encode(['success' =&gt; false, 'error' =&gt; 'Impossible d\'écrire le fichier .env']);&#10;    }&#10;    exit;&#10;}&#10;&#10;if ($_GET['action'] ?? '' === 'deploy') {&#10;    header('Content-Type: text/plain');&#10;&#10;    echo &quot;=== Installation de Composer ===\n&quot;;&#10;    if (!file_exists('composer.phar')) {&#10;        echo &quot;Téléchargement de Composer...\n&quot;;&#10;        file_put_contents('composer.phar', file_get_contents('https://getcomposer.org/composer.phar'));&#10;        chmod('composer.phar', 0755);&#10;    }&#10;    echo &quot;✅ Composer prêt\n\n&quot;;&#10;&#10;    echo &quot;=== Installation des dépendances ===\n&quot;;&#10;    $output = shell_exec('php composer.phar install --no-dev --optimize-autoloader --no-interaction 2&gt;&amp;1');&#10;    echo $output . &quot;\n&quot;;&#10;&#10;    echo &quot;=== Déploiement complet ===\n&quot;;&#10;    $output = shell_exec('php bin/console app:deploy prod 2&gt;&amp;1');&#10;    echo $output . &quot;\n&quot;;&#10;&#10;    echo &quot;=== Configuration des permissions ===\n&quot;;&#10;    if (is_dir('var/cache')) {&#10;        chmod('var/cache', 0775);&#10;        echo &quot;✅ Permissions var/cache configurées\n&quot;;&#10;    }&#10;    if (is_dir('var/log')) {&#10;        chmod('var/log', 0775);&#10;        echo &quot;✅ Permissions var/log configurées\n&quot;;&#10;    }&#10;&#10;    echo &quot;\n DÉPLOIEMENT RÉUSSI !\n&quot;;&#10;    echo &quot;Votre Pedantix est maintenant opérationnel !\n&quot;;&#10;    exit;&#10;}&#10;?&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>